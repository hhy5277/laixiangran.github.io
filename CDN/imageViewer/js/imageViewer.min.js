!function(t,i){"use strict";var e=t.imageViewer=function(t,i){this._initialize(t,i),this._initMode(),this._toolsAddEvent(),this._support?(this._initContainer(),this._init(),this.options.sources.length>0?this.load(this.options.sources[0]):this.onError("without a image.")):this.onError("not support this mode.")};e.prototype={_initialize:function(t,i){var e=COM.$D.byId(t);e.innerHTML='<div class="imageViewerContext"><div class="imageViewer"></div><div class="smallImageViewer"><div class="previousImg toImg" title="向左查看"> << </div><div class="nextImg toImg" title="向右查看"> >> </div><div class="moreImg"></div></div><div class="imageTools"><button class="btn imageZoomin">放大</button><button class="btn imageZoomout">缩小</button><button class="btn rotateLeft">向左旋转</button><button class="btn rotateRight">向右旋转</button><button class="btn flipVertical">垂直翻转</button><button class="btn flipHorizontal">水平翻转</button><button class="btn imageReset">重置</button></div></div>';var n=this._container=COM.$D.byClassName("imageViewer")[0],s=this._moreImg=COM.$D.byClassName("moreImg")[0];COM.$D.setStyle(n,"height",e.clientHeight-150+"px"),this._clientWidth=n.clientWidth,this._clientHeight=n.clientHeight,this._img=new Image,this._style={},this._x=this._y=1,this._radian=0,this._support=!1,this._init=this._load=this._show=this._dispose=COM.$O.noop;var o=this._setOptions(i);COM.$A.forEach(o.sources,function(t){var i=new Image;i.src=t,s.appendChild(i)}),this._zoom=o.zoom,this.onPreLoad=o.onPreLoad,this.onLoad=o.onLoad,this.onError=o.onError,this._LOAD=COM.$F.bind(function(){this.onLoad(),this._load(),this.reset()},this),COM.$CE.fireEvent(this,"init")},_toolsAddEvent:function(){var t=this;COM.$E.addEvent(COM.$D.byClassName("imageZoomin")[0],"click",function(){t.zoomin()}),COM.$E.addEvent(COM.$D.byClassName("imageZoomout")[0],"click",function(){t.zoomout()}),COM.$E.addEvent(COM.$D.byClassName("flipVertical")[0],"click",function(){t.vertical()}),COM.$E.addEvent(COM.$D.byClassName("flipHorizontal")[0],"click",function(){t.horizontal()}),COM.$E.addEvent(COM.$D.byClassName("rotateLeft")[0],"click",function(){t.left()}),COM.$E.addEvent(COM.$D.byClassName("rotateRight")[0],"click",function(){t.right()}),COM.$E.addEvent(COM.$D.byClassName("imageReset")[0],"click",function(){t.reset()}),COM.$E.addEvent(COM.$D.byClassName("previousImg")[0],"click",function(i){var e=Number(COM.$D.getStyle(t._moreImg,"left").split("px")[0])+t._clientWidth;0>e?COM.$D.setStyle(t._moreImg,"left",e+"px"):COM.$D.setStyle(t._moreImg,"left",0)}),COM.$E.addEvent(COM.$D.byClassName("nextImg")[0],"click",function(i){var e=Number(COM.$D.getStyle(t._moreImg,"left").split("px")[0])-t._clientWidth;-t._moreImg.clientWidth<e&&COM.$D.setStyle(t._moreImg,"left",e+"px")}),COM.$A.forEach(COM.$D.byClassName("moreImg")[0].getElementsByTagName("img"),function(i){COM.$E.addEvent(i,"click",function(i){t.load(i.target.src)})})},_setOptions:function(t){return this.options={sources:[],mode:"css3|filter|canvas",zoom:.1,onPreLoad:function(){},onLoad:function(){},onError:function(t){throw new Error(t)}},COM.$O.extend(this.options,t||{})},_initMode:function(){var t=e.modes;this._support=COM.$A.some(this.options.mode.toLowerCase().split("|"),function(i){return i=t[i],i&&i.support?(i.init&&(this._init=i.init),i.load&&(this._load=i.load),i.show&&(this._show=i.show),i.dispose&&(this._dispose=i.dispose),COM.$A.forEach(e.transforms,function(t,i){var e=this;this[i]=function(){t.apply(this,[].slice.call(arguments)),e._show()}},this),!0):void 0},this)},_initContainer:function(){var t=this._container,i=t.style,e=COM.$D.getStyle(t,"position");this._style={position:i.position,overflow:i.overflow},"relative"!=e&&"absolute"!=e&&(i.position="relative"),i.overflow="hidden",COM.$CE.fireEvent(this,"initContainer")},load:function(t){var i=this,e=i._img;i._support&&(i.onPreLoad(),e.onload||(e.onload=i._LOAD),e.onerror||(e.onerror=function(){i.onError("err image")}),e.src=t)},reset:function(){this._support&&(this._x=this._y=1,this._radian=0,this._context?(this._imgInitLeft=-this._img.width/2,this._imgInitTop=-this._img.height/2):(this._img.style.top=this._imgInitTop,this._img.style.left=this._imgInitLeft),this._show())},dispose:function(){this._support&&(this._dispose(),COM.$CE.fireEvent(this,"dispose"),COM.$D.setStyle(this._container,this._style),this._container=this._img=this._img.onload=this._img.onerror=this._LOAD=null)}},e.modes=function(){function t(t,i){COM.$D.setStyle(t,{position:"absolute",border:0,padding:0,margin:0,width:"auto",height:"100%",visibility:"hidden"}),i.appendChild(t)}function i(t,i,e){var n=Math.cos(t),s=Math.sin(t);return{M11:n*i,M12:-s*e,M21:s*i,M22:n*e}}var e;return{css3:{support:function(){var t=document.createElement("div").style;return COM.$A.some(["transform","MozTransform","webkitTransform","OTransform"],function(i){return i in t?(e=i,!0):void 0})}(),init:function(){t(this._img,this._container)},load:function(){this._imgInitTop=(this._clientHeight-this._img.offsetHeight)/2+"px",this._imgInitLeft=(this._clientWidth-this._img.offsetWidth)/2+"px",COM.$D.setStyle(this._img,{top:this._imgInitTop,left:this._imgInitLeft,visibility:"visible"})},show:function(){var t=i(this._radian,this._y,this._x);this._img.style[e]="matrix("+t.M11.toFixed(16)+","+t.M21.toFixed(16)+","+t.M12.toFixed(16)+","+t.M22.toFixed(16)+", 0, 0)"},dispose:function(){this._container.removeChild(this._img)}},filter:{support:function(){return"filters"in document.createElement("div")}(),init:function(){t(this._img,this._container),this._img.style.filter="progid:DXimageViewerform.Microsoft.Matrix(SizingMethod='auto expand')"},load:function(){this._img.onload=null,this._img.style.visibility="visible"},show:function(){COM.$O.extend(this._img.filters.item("DXimageViewerform.Microsoft.Matrix"),i(this._radian,this._y,this._x)),this._imgInitTop=this._img.style.top=(this._clientHeight-this._img.offsetHeight)/2+"px",this._imgInitLeft=this._img.style.left=(this._clientWidth-this._img.offsetWidth)/2+"px"},dispose:function(){this._container.removeChild(this._img)}},canvas:{support:function(){return"getContext"in document.createElement("canvas")}(),init:function(){var t=this._canvas=document.createElement("canvas");this._context=t.getContext("2d");COM.$D.setStyle(t,{position:"absolute",left:0,top:0}),t.width=this._clientWidth,t.height=this._clientHeight,this._container.appendChild(t)},show:function(){var t=this._img,i=this._context,e=this._clientWidth,n=this._clientHeight;i.save(),i.clearRect(0,0,e,n),i.translate(e/2,n/2),i.rotate(this._radian),i.scale(this._y,this._x),this._imgInitLeft=this._imgInitLeft||-t.width/2,this._imgInitTop=this._imgInitTop||-t.height/2,i.drawImage(t,this._imgInitLeft,this._imgInitTop),i.restore()},dispose:function(){this._container.removeChild(this._canvas),this._canvas=this._context=null}}}}(),e.transforms={vertical:function(){this._radian=Math.PI-this._radian,this._y*=-1},horizontal:function(){this._radian=Math.PI-this._radian,this._x*=-1},rotate:function(t){this._radian=t},left:function(){this._radian-=Math.PI/2},right:function(){this._radian+=Math.PI/2},rotateByDegress:function(t){this._radian=t*Math.PI/180},scale:function(){function t(t,i){return t>0&&t>-i?i:0>t&&i>t?-i:0}return function(i){if(i){var e=t(this._y,i),n=t(this._x,i);e&&n&&(this._y+=e,this._x+=n)}}}(),zoomin:function(){this.scale(Math.abs(this._zoom))},zoomout:function(){this.scale(-Math.abs(this._zoom))}},e.prototype._initialize=function(){function i(i){var e=this._container;if(m=i.button,1===m){var n=COM.$D.getClientRect(this._container);this._mrX=n.left+this._clientWidth/2,this._mrY=n.top+this._clientHeight/2,this._mrRadian=Math.atan2(i.clientY-this._mrY,i.clientX-this._mrX)-this._radian}else 0===m&&(this._mrX=i.clientX,this._mrY=i.clientY,this._context?(h=parseInt(this._imgInitLeft),a=parseInt(this._imgInitTop)):(a=parseInt(this._img.style.top),h=parseInt(this._img.style.left)));COM.$E.addEvent(document,"mousemove",this._mrMOVE),COM.$E.addEvent(document,"mouseup",this._mrSTOP),COM.$B.browser.ie?(COM.$E.addEvent(e,"losecapture",this._mrSTOP),e.setCapture()):(COM.$E.addEvent(t,"blur",this._mrSTOP),i.preventDefault())}function n(i){if(1===m)this.rotate(Math.atan2(i.clientY-this._mrY,i.clientX-this._mrX)-this._mrRadian);else if(0===m){var e=parseInt(i.clientY-this._mrY),n=parseInt(i.clientX-this._mrX);this._context?(this._imgInitLeft=h+n,this._imgInitTop=a+e,this._show()):(this._img.style.top=a+e+"px",this._img.style.left=h+n+"px")}t.getSelection?t.getSelection().removeAllRanges():document.selection.empty()}function s(){if(COM.$E.removeEvent(document,"mousemove",this._mrMOVE),COM.$E.removeEvent(document,"mouseup",this._mrSTOP),COM.$B.browser.ie){var i=this._container;COM.$E.removeEvent(i,"losecapture",this._mrSTOP),i.releaseCapture()}else COM.$E.removeEvent(t,"blur",this._mrSTOP)}var o=e.prototype._initialize,r={init:function(){this._mrX=this._mrY=this._mrRadian=0,this._mrSTART=COM.$F.bind(i,this),this._mrMOVE=COM.$F.bind(n,this),this._mrSTOP=COM.$F.bind(s,this)},initContainer:function(){COM.$E.addEvent(this._container,"mousedown",this._mrSTART)},dispose:function(){COM.$E.removeEvent(this._container,"mousedown",this._mrSTART),this._mrSTOP(),this._mrSTART=this._mrMOVE=this._mrSTOP=null}},a=0,h=0,m=0;return function(){var t=arguments[1];t&&t.mouseRotate===!1||COM.$A.forEach(r,function(t,i){COM.$CE.addEvent(this,i,t)},this),o.apply(this,arguments)}}(),e.prototype._initialize=function(){function t(t){this.scale((t.wheelDelta?t.wheelDelta/-120:(t.detail||0)/3)*Math.abs(this._zoom)),t.preventDefault()}var i=e.prototype._initialize,n=COM.$B.browser.firefox?"DOMMouseScroll":"mousewheel",s={init:function(){this._mzZoom=COM.$F.bind(t,this)},initContainer:function(){COM.$E.addEvent(this._container,n,this._mzZoom)},dispose:function(){COM.$E.removeEvent(this._container,n,this._mzZoom),this._mzZoom=null}};return function(){var t=arguments[1];t&&t.mouseZoom===!1||COM.$A.forEach(s,function(t,i){COM.$CE.addEvent(this,i,t)},this),i.apply(this,arguments)}}(),"function"==typeof define&&define([],function(){return e})}(window);